# 백엔드 연동 테스트 가이드

## 📋 테스트 전 준비사항

### 1. 백엔드 서버 실행 확인
- 백엔드 서버가 `ws://localhost:8080`에서 실행 중인지 확인
- 또는 환경 변수 `EXPO_PUBLIC_WS_URL`로 다른 URL 설정 가능

### 2. 환경 변수 설정 (선택사항)
`.env` 파일 생성 또는 환경 변수 설정:
```bash
EXPO_PUBLIC_WS_URL=ws://localhost:8080
```

### 3. 앱 실행
```bash
npm start
```

---

## 🧪 테스트 시나리오

### 1단계: 기본 연결 테스트

#### 1.1 WebSocket 연결 성공 확인
**테스트 방법:**
1. 앱 실행 후 로비 화면으로 이동
2. 게임 ID와 플레이어 이름 입력
3. "로비 참가" 버튼 클릭

**예상 결과:**
- ✅ Toast 메시지: "로비에 연결되었습니다"
- ✅ 이벤트 로그에 "로비에 연결되었습니다. 플레이어 ID: [UUID]" 표시
- ✅ 로딩 인디케이터 사라짐
- ✅ 연결 상태가 "연결됨"으로 변경

**확인 사항:**
- [ ] WebSocket 연결 성공
- [ ] `CONNECTION_ESTABLISHED` 메시지 수신
- [ ] 플레이어 ID (UUID) 저장 확인
- [ ] UI 상태 업데이트 확인

**디버깅:**
- Chrome DevTools Console에서 WebSocket 메시지 확인
- Redux DevTools에서 `player.currentPlayerId` 확인

---

#### 1.2 연결 실패 처리 확인
**테스트 방법:**
1. 백엔드 서버를 중지한 상태에서 연결 시도

**예상 결과:**
- ✅ Toast 에러 메시지 표시
- ✅ 연결 상태가 "연결 실패"로 변경
- ✅ 재시도 옵션 제공

**확인 사항:**
- [ ] 에러 메시지가 사용자에게 표시됨
- [ ] 연결 상태가 올바르게 업데이트됨

---

### 2단계: 로비 기능 테스트

#### 2.1 로비 참가 후 플레이어 목록 수신
**테스트 방법:**
1. 첫 번째 플레이어로 로비 참가
2. 두 번째 플레이어로 로비 참가 (다른 기기 또는 시뮬레이터)

**예상 결과:**
- ✅ 플레이어 목록에 참가한 플레이어들이 표시됨
- ✅ 각 플레이어의 역할, 재력, 영향력 정보 표시
- ✅ AI 플레이어가 있다면 🤖 배지 표시

**확인 사항:**
- [ ] 플레이어 목록이 실시간으로 업데이트됨
- [ ] 플레이어 정보가 올바르게 표시됨
- [ ] AI 플레이어 구분이 명확함

**디버깅:**
- Redux DevTools에서 `game.gameState.players` 확인
- Chrome DevTools에서 `GAME_STATE_UPDATE` 메시지 확인

---

#### 2.2 게임 시작 기능 테스트
**테스트 방법:**
1. 최소 4명의 플레이어가 로비에 참가 (또는 AI 포함)
2. "게임 시작" 버튼 클릭

**예상 결과:**
- ✅ `START_GAME` 메시지가 서버로 전송됨
- ✅ 서버에서 `GAME_STATE_UPDATE` 메시지 수신
- ✅ 게임 화면으로 자동 전환
- ✅ 게임 상태가 올바르게 표시됨

**확인 사항:**
- [ ] `START_GAME` 메시지 전송 확인 (Chrome DevTools)
- [ ] 게임 화면으로 네비게이션됨
- [ ] 게임 상태가 올바르게 렌더링됨

**디버깅:**
- Chrome DevTools Network 탭에서 WebSocket 메시지 확인
- Redux DevTools에서 `game.gameState` 확인

---

### 3단계: 게임 진행 테스트

#### 3.1 GAME_STATE_UPDATE 수신 및 UI 업데이트
**테스트 방법:**
1. 게임이 시작된 상태에서 서버에서 상태 업데이트 발생 대기
2. 턴이 변경되거나 플레이어 상태가 변경될 때

**예상 결과:**
- ✅ 게임 보드의 플레이어 정보가 업데이트됨
- ✅ 현재 턴 표시가 변경됨
- ✅ 이벤트 로그에 새로운 이벤트 추가됨

**확인 사항:**
- [ ] UI가 실시간으로 업데이트됨
- [ ] 이벤트 로그가 올바르게 표시됨
- [ ] 플레이어 상태 변경이 반영됨

---

#### 3.2 USE_CARD 액션 전송 및 응답
**테스트 방법:**
1. 현재 턴인 플레이어로 카드 선택
2. 타겟이 필요한 카드인 경우 타겟 선택
3. 카드 사용 버튼 클릭

**예상 결과:**
- ✅ 타겟팅 모드 활성화 (필요한 경우)
- ✅ 타겟 선택 가능한 플레이어 하이라이트
- ✅ 카드 사용 액션이 서버로 전송됨
- ✅ 서버 응답 후 게임 상태 업데이트

**확인 사항:**
- [ ] 타겟팅 UI가 올바르게 표시됨
- [ ] `USE_CARD` 액션이 올바른 형식으로 전송됨
- [ ] 서버 응답 후 상태 업데이트 확인

**디버깅:**
- Chrome DevTools에서 전송된 메시지 확인:
```json
{
  "type": "PLAYER_ACTION",
  "action": {
    "type": "USE_CARD",
    "cardId": "...",
    "targetId": "..." // 선택사항
  }
}
```

---

#### 3.3 END_TURN 액션 테스트
**테스트 방법:**
1. 현재 턴인 플레이어로 "턴 종료" 버튼 클릭

**예상 결과:**
- ✅ `END_TURN` 액션이 서버로 전송됨
- ✅ 서버에서 다음 턴으로 상태 업데이트
- ✅ 다음 플레이어의 턴으로 변경

**확인 사항:**
- [ ] 턴 종료 액션 전송 확인
- [ ] 턴 변경이 올바르게 반영됨

---

#### 3.4 RESPOND_ATTACK 액션 테스트
**테스트 방법:**
1. 공격을 받은 플레이어로 "회피" 또는 "포기" 선택

**예상 결과:**
- ✅ 응답 모달이 표시됨
- ✅ 선택한 응답이 서버로 전송됨
- ✅ 게임 상태가 업데이트됨

**확인 사항:**
- [ ] 응답 모달이 올바르게 표시됨
- [ ] `RESPOND_ATTACK` 액션이 올바른 형식으로 전송됨

---

### 4단계: 에러 처리 테스트

#### 4.1 잘못된 액션 전송 시 에러 응답
**테스트 방법:**
1. 현재 턴이 아닌 플레이어로 액션 전송 시도
2. 유효하지 않은 카드 사용 시도

**예상 결과:**
- ✅ 서버에서 에러 메시지 수신
- ✅ Toast로 에러 메시지 표시
- ✅ 이벤트 로그에 에러 이벤트 추가

**확인 사항:**
- [ ] 에러 메시지가 사용자에게 표시됨
- [ ] 에러 로그가 기록됨

---

#### 4.2 네트워크 끊김 시 재연결 테스트
**테스트 방법:**
1. 게임 진행 중 백엔드 서버 중지
2. 서버 재시작 후 재연결 시도

**예상 결과:**
- ✅ 연결 끊김 감지
- ✅ 재연결 시도 (설정된 횟수만큼)
- ✅ 재연결 성공 시 상태 복구

**확인 사항:**
- [ ] 연결 끊김이 감지됨
- [ ] 재연결 시도가 진행됨
- [ ] 재연결 성공 시 상태가 복구됨

---

## 🔍 디버깅 도구

### 1. Chrome DevTools
- **Network 탭**: WebSocket 메시지 확인
- **Console 탭**: 로그 메시지 확인
- **Redux DevTools**: Redux 상태 확인

### 2. Redux DevTools
설치 및 사용:
```bash
npm install --save-dev redux-devtools-extension
```

### 3. 로그 확인
- `console.log`: 일반 로그
- `console.error`: 에러 로그
- `console.warn`: 경고 로그

---

## 📝 테스트 체크리스트

### 기본 연결
- [ ] WebSocket 연결 성공
- [ ] CONNECTION_ESTABLISHED 수신
- [ ] 플레이어 ID 저장
- [ ] 연결 실패 처리

### 로비 기능
- [ ] 로비 참가
- [ ] 플레이어 목록 표시
- [ ] 게임 시작 요청
- [ ] 게임 화면 전환

### 게임 진행
- [ ] GAME_STATE_UPDATE 수신
- [ ] UI 상태 업데이트
- [ ] USE_CARD 액션 전송
- [ ] 타겟팅 시스템
- [ ] END_TURN 액션
- [ ] RESPOND_ATTACK 액션

### 에러 처리
- [ ] 잘못된 액션 에러 처리
- [ ] 네트워크 끊김 처리
- [ ] 재연결 시도
- [ ] 에러 메시지 표시

---

## ⚠️ 알려진 이슈 및 제한사항

1. **AI 플레이어**: 현재 UI만 구현되어 있으며, 실제 AI 로직은 백엔드에서 처리됨
2. **방 생성**: 현재 UI만 구현되어 있으며, 실제 방 생성 API는 백엔드와 협의 필요
3. **재연결**: 자동 재연결은 구현되어 있으나, 상태 복구는 백엔드 지원 필요

---

## 📞 문제 발생 시

1. **연결 실패**: 백엔드 서버 실행 상태 확인
2. **메시지 수신 안 됨**: WebSocket URL 및 프로토콜 확인
3. **UI 업데이트 안 됨**: Redux 상태 및 이벤트 핸들러 확인
4. **에러 발생**: Chrome DevTools Console 및 Redux DevTools 확인

---

**마지막 업데이트**: 2025-12-12

